# Nachos Default Security Policies - Permissive Mode
#
# Permissive mode provides maximum flexibility:
# - Most tools enabled
# - DMs allowed by default
# - Minimal restrictions
# - Broader filesystem access
# - Broader network access
#
# ⚠️  WARNING: Use with caution - requires explicit opt-in

version: "1.0"

metadata:
  name: "Permissive Mode Security Policies"
  description: "Maximum flexibility - minimal restrictions"
  mode: "permissive"

rules:
  # ============================================================================
  # LLM Access - Always allowed
  # ============================================================================
  - id: "permissive-llm-allow"
    description: "Allow LLM calls in permissive mode"
    priority: 1000
    match:
      resource: "llm"
      action: "call"
    effect: "allow"

  # ============================================================================
  # DM Access - Allow all DMs
  # ============================================================================
  - id: "permissive-dm-allow"
    description: "Allow all DMs in permissive mode"
    priority: 900
    match:
      resource: "dm"
      action: ["send", "receive"]
    effect: "allow"

  # ============================================================================
  # Channel Messages - Allow
  # ============================================================================
  - id: "permissive-channel-allow"
    description: "Allow channel messages in permissive mode"
    priority: 850
    match:
      resource: "channel"
      action: ["send", "receive"]
    effect: "allow"

  # ============================================================================
  # Tools - Most tools enabled
  # ============================================================================

  # Browser tool - Full access (SecurityTier: STANDARD)
  - id: "permissive-tool-browser"
    description: "Allow browser tool with full access"
    priority: 800
    match:
      resource: "tool"
      resourceId: "browser"
    effect: "allow"
    audit: true

  # Filesystem Read - Broader access (still deny system paths)
  - id: "permissive-tool-filesystem-read"
    description: "Allow filesystem read with broader access"
    priority: 750
    match:
      resource: "tool"
      resourceId: "filesystem_read"
    conditions:
      # Deny system directories
      - field: "parameters.path"
        operator: "not_starts_with_any"
        value:
          - "/etc"
          - "/sys"
          - "/proc"
          - "/dev"
          - "/root"
    effect: "allow"

  - id: "permissive-tool-filesystem-read-deny-system"
    description: "Deny filesystem read in system directories"
    priority: 749
    match:
      resource: "tool"
      resourceId: "filesystem_read"
    effect: "deny"
    reason: "System directories are not accessible even in permissive mode"

  # Filesystem Write - Broader access (still deny system paths)
  - id: "permissive-tool-filesystem-write"
    description: "Allow filesystem write with broader access"
    priority: 740
    match:
      resource: "tool"
      resourceId: "filesystem_write"
    conditions:
      # Deny system directories
      - field: "parameters.path"
        operator: "not_starts_with_any"
        value:
          - "/etc"
          - "/sys"
          - "/proc"
          - "/dev"
          - "/root"
    effect: "allow"
    audit: true

  - id: "permissive-tool-filesystem-write-deny-system"
    description: "Deny filesystem write in system directories"
    priority: 739
    match:
      resource: "tool"
      resourceId: "filesystem_write"
    effect: "deny"
    reason: "System directories are not accessible even in permissive mode"

  # Filesystem Edit - Broader access
  - id: "permissive-tool-filesystem-edit"
    description: "Allow filesystem edit with broader access"
    priority: 730
    match:
      resource: "tool"
      resourceId: "filesystem_edit"
    conditions:
      - field: "parameters.path"
        operator: "not_starts_with_any"
        value:
          - "/etc"
          - "/sys"
          - "/proc"
          - "/dev"
          - "/root"
    effect: "allow"
    audit: true

  - id: "permissive-tool-filesystem-edit-deny-system"
    description: "Deny filesystem edit in system directories"
    priority: 729
    match:
      resource: "tool"
      resourceId: "filesystem_edit"
    effect: "deny"
    reason: "System directories are not accessible even in permissive mode"

  # Filesystem Patch - Broader access
  - id: "permissive-tool-filesystem-patch"
    description: "Allow filesystem patch with broader access"
    priority: 720
    match:
      resource: "tool"
      resourceId: "filesystem_patch"
    conditions:
      - field: "parameters.path"
        operator: "not_starts_with_any"
        value:
          - "/etc"
          - "/sys"
          - "/proc"
          - "/dev"
          - "/root"
    effect: "allow"
    audit: true

  - id: "permissive-tool-filesystem-patch-deny-system"
    description: "Deny filesystem patch in system directories"
    priority: 719
    match:
      resource: "tool"
      resourceId: "filesystem_patch"
    effect: "deny"
    reason: "System directories are not accessible even in permissive mode"

  # Code Runner Python - Allow (still requires user approval due to RESTRICTED tier)
  - id: "permissive-tool-code-runner-python"
    description: "Allow Python code runner"
    priority: 700
    match:
      resource: "tool"
      resourceId: "code_runner_python"
    effect: "allow"
    audit: true
    require_approval: true

  # Code Runner JavaScript - Allow (still requires user approval due to RESTRICTED tier)
  - id: "permissive-tool-code-runner-javascript"
    description: "Allow JavaScript code runner"
    priority: 690
    match:
      resource: "tool"
      resourceId: "code_runner_javascript"
    effect: "allow"
    audit: true
    require_approval: true

  # ============================================================================
  # Network Access - Broader access
  # ============================================================================

  # Allow network access broadly (but still log it)
  - id: "permissive-network-allow"
    description: "Allow network access in permissive mode"
    priority: 600
    match:
      resource: "network"
      action: "read"
    effect: "allow"

  # Still deny network write operations (prevent data exfiltration)
  - id: "permissive-network-write-deny"
    description: "Deny network write operations"
    priority: 599
    match:
      resource: "network"
      action: "write"
    effect: "deny"
    reason: "Network write operations are not allowed (prevents data exfiltration)"
